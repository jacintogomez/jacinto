<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ml5 Detection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/addons/p5.dom.min.js"></script>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <script src="detect_from_webcam.js">
        let img;
        let detector;
        //img.crossOrigin='Anonymous';

        function preload(){
            img=loadImage('img/puffin.jpg');
            detector=ml5.objectDetector('cocossd');
        }

        function gotdetections(error,results){
            if(error){console.error(error);}
            console.log(results);
            for(let i=0;i<results.length;i++){
                let ob=results[i];
                let xnorm=ob.normalized.x*width;
                let ynorm=ob.normalized.y*height;
                let wnorm=ob.normalized.width*width;
                let hnorm=ob.normalized.height*height;
                stroke(0,255,0);
                strokeWeight(4);
                noFill();
                rect(xnorm,ynorm,wnorm,hnorm);
                noStroke();
                fill(255);
                textSize(24);
                text(ob.label+', with '+(ob.confidence*100).toFixed(2)+'% confidence',xnorm+10,ynorm+24);
            }
        }

        function setup(){
            createCanvas(640,480);
            //canvas.parent('content');
            image(img,0,0,width,height);
            detector.detect(img,gotdetections);
            document.getElementById('content').appendChild(canvas);
        }
    </script>
    <style>
        body{
            text-align: center;
            margin: 3%;
        }
        .viewbox{
            display: flex;
            align-content: center;
            justify-content: center;
            background-color: black;
            margin: 5%;
            border-radius: 30px;
        }
        canvas{
            flex: 1;
            margin: 5%;
            border-radius: 30px;
            background-color: gray;
            visibility: visible !important;
        }
    </style>
</head>
<body>
    <h1>Object Detection with ml5.js</h1>
    <div class="viewbox">
        <div class="camera" id="content">

        </div>
    </div>
</body>
</html>